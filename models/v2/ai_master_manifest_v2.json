{
  "manifest_version": "2.0",
  "system_name": "Øyna Waterworks AI System",
  "description": "Unified AI manifest integrating API contract, digital twin, master system model and knowledge graph for the Øyna Waterworks AI Agent.",

  "models": {
    "knowledge_graph": {
      "id": "oyna_knowledge_graph_v1",
      "path": "models/v1/oyna_knowledge_graph_v1.json",
      "description": "Semantic graph of all components, entities, flows, devices and causal relations"
    },
    "api_contract": {
      "id": "oyna_api_contract_v1",
      "path": "models/v1/oyna_ai_api_contract_v1.json",
      "description": "Public API structure for AI-to-system communication"
    },
    "digital_twin": {
      "id": "oyna_digital_twin_v1",
      "path": "models/v1/oyna_digital_twin_v1.json",
      "description": "Virtual representation of physical, electrical, hydraulic and software layers"
    },
    "master_system_model": {
      "id": "oyna_master_system_model_v1",
      "path": "models/v1/oyna_master_system_model_v1.json",
      "description": "Canonical model combining physical, electrical, I/O, software, safety and causal structure"
    }
  },

  "relationships": {
    "knowledge_graph_based_on": "master_system_model",
    "digital_twin_derives_from": [
      "master_system_model.physical_layer",
      "master_system_model.electrical_layer",
      "master_system_model.io_layer",
      "master_system_model.software_layer"
    ],
    "api_contract_exposes": [
      "digital_twin",
      "master_system_model",
      "knowledge_graph"
    ],
    "ai_runtime_requires": [
      "api_contract",
      "digital_twin",
      "knowledge_graph"
    ],

    "pump_control": {
      "depends_on": [
        "api_contract",
        "master_system_model",
        "digital_twin"
      ],
      "uses_entities": [
        "switch.pressure_pump_contactor",
        "binary_sensor.pressure_pump_running",
        "sensor.waterflow_total_liters"
      ]
    },
    "leak_detection": {
      "depends_on": [
        "master_system_model",
        "knowledge_graph",
        "influxdb"
      ],
      "uses_influx": [
        "bucket:haos-oyna-waterflow"
      ]
    },
    "pressure_estimation": {
      "depends_on": [
        "digital_twin",
        "flow dynamics",
        "structured model relationships"
      ]
    }
  },

  "ai_runtime": {
    "embedding_strategy": {
      "chunk_size_chars": 1800,
      "overlap_chars": 200,
      "index_priority": [
        "master_system_model",
        "knowledge_graph",
        "digital_twin",
        "api_contract"
      ],
      "metadata_fields": [
        "model_id",
        "node_id",
        "entity_type",
        "layer",
        "component_role"
      ]
    },
    "prompt_router": {
      "routes": {
        "status": "api_contract.system.get_status",
        "history": "api_contract.history.get_history",
        "topology": "master_system_model",
        "device_relations": "knowledge_graph",
        "digital_twin_simulation": "digital_twin",
        "control": "api_contract.control"
      }
    }
  },

  "integration": {
    "home_assistant": {
      "api": {
        "base_url": "http://haos.local:8123",
        "endpoints": "from_api_contract",
        "authentication": "bearer_token"
      },
      "entities": "defined_in_matcher:model=master_system_model"
    },
    "node_red": {
      "flows": "inferred_from_knowledge_graph",
      "tooling": {
        "query": "supports ha service calls, mqtt, and http"
      }
    },
    "influxdb": {
      "buckets": "from master_system_model",
      "usage": "historical metrics, pump cycles, flow data"
    }
  },

  "semantic_layers": {
    "operational_layer": {
      "source": "master_system_model",
      "provides": [
        "Pump cycles",
        "Flow dynamics",
        "Pressure model",
        "Leak detection",
        "Anomaly detection",
        "System-mode transitions"
      ]
    },
    "structural_layer": {
      "source": "digital_twin",
      "provides": [
        "Pipes",
        "Valves",
        "Pump relations",
        "Sensor placement",
        "Data provenance"
      ]
    },
    "knowledge_layer": {
      "source": "knowledge_graph",
      "provides": [
        "Entity linking",
        "Semantic categories",
        "Cross-model relationships",
        "Query mapping"
      ]
    },
    "api_layer": {
      "source": "api_contract",
      "provides": [
        "Tool interface for AI agent",
        "External access schema",
        "Introspectable operations"
      ]
    }
  },

  "agent_runtime": {
    "tools": {
      "home_assistant": {
        "actions": [
          "get_entity_state",
          "call_service",
          "list_entities"
        ]
      },
      "node_red": {
        "actions": [
          "invoke_flow",
          "inject_data",
          "subscribe"
        ]
      },
      "influxdb": {
        "actions": [
          "query_latest",
          "query_range",
          "write_point"
        ]
      }
    },
    "reasoning": {
      "supports": [
        "goal decomposition",
        "temporal reasoning",
        "physical system modeling",
        "safety constraints",
        "uncertainty handling"
      ],
      "constraints": [
        "preserve system integrity",
        "never override safety limits",
        "all pump control routed through HA"
      ]
    }
  },

  "ai_agent_entrypoint": {
    "main_manifest": "ai_master_manifest_v2",
    "load_order": [
      "manifest_v1",
      "api_contract",
      "digital_twin",
      "master_system_model",
      "knowledge_graph"
    ],
    "guarantees": [
      "all models validated before load",
      "all schemas satisfied",
      "relationships compiled"
    ]
  },

  "metadata": {
    "generated_at": "2025-12-05T00:00:00+01:00",
    "author": "Øyna Vassverk – AI System Builder",
    "schema_version": "1.0"
  }
}
